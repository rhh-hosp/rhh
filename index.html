<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Search and Filter Data</title>
    <link href="https://fonts.googleapis.com/css2?family=Almarai&family=Georgia&display=swap" rel="stylesheet">
    <style>
        /* Global Background */
        body {
            background-image: url('https://github.com/ykhafaja/my-html-site/blob/main/Background.jpg?raw=true');
            background-size: cover;
            background-position: center;
            font-family: 'Georgia', serif;
            margin: 0;
            padding: 0;
            width: 100%;
            overflow-x: hidden;
        }

        /* Header Section */
        .header {
            background-image: url('https://github.com/ykhafaja/my-html-site/blob/main/About_banner-about.jpg?raw=true');
            background-size: cover;
            background-position: center;
            height: 250px;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            text-align: center;
            font-size: 2rem;
            font-weight: bold;
            padding: 0 20px;
            width: 100%;
            box-sizing: border-box;
        }

        /* Search Section */
        .search-container {
            margin: 20px 0;
            text-align: center;
            width: 100%;
        }

        .search-container label {
            font-size: 1.2rem;
            font-weight: bold;
            display: block;
            margin-bottom: 10px;
            color: #691636;
        }

        .search-container .arabic-label {
            font-family: 'Almarai', sans-serif;
        }

        input[type="text"] {
            width: 80%;
            padding: 12px;
            margin-bottom: 20px;
            font-size: 16px;
            border: 1px solid #691636;
            border-radius: 4px;
            box-sizing: border-box;
        }

        /* Table Wrapper */
        .table-container {
            width: 100%;
            overflow-x: auto;
            display: block;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        th,
        td {
            padding: 14px;
            border: 1px solid #ddd;
            text-align: center;
            vertical-align: middle;
            font-size: 16px;
            color: #691636;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        th {
            background-color: #691636;
            color: white;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        td {
            background-color: #f9f9f9;
        }

        /* Alternating row colors */
        tr:nth-child(even) {
            background-color: #f4f4f4;
        }

        tr:hover {
            background-color: #ddd;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            th,
            td {
                font-size: 14px;
                padding: 10px;
            }

            table {
                table-layout: fixed;
            }

            .table-container {
                overflow-x: hidden;
            }
        }
    </style>
</head>

<body>

    <div class="header">
        <span>Doctor Information</span>
    </div>

    <div class="search-container">
        <label for="search">Search:</label>
        <input type="text" id="search" placeholder="Search by Department or Specialty" onkeyup="searchTable()">

        <label for="departmentDropdown">Select Department:</label>
        <select id="departmentDropdown" onchange="updateSpecialtyDropdown()">
            <option value="">All Departments</option>
        </select>

        <label for="specialtyDropdown">Select Specialty:</label>
        <select id="specialtyDropdown">
            <option value="">All Specialties</option>
        </select>
    </div>

    <div class="table-container">
        <table id="doctorTable">
            <thead>
                <tr>
                    <th>Floor</th>
                    <th>Department</th>
                    <th>Specialty</th>
                </tr>
            </thead>
            <tbody>
                <!-- Table rows will be inserted here dynamically -->
            </tbody>
        </table>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <script>
        var allData = [];
        var csvUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vThqvDdT8gY65dr-DbNdiE8SMGPaWkrTEr7ZG-UMfl3XDRfIlMZmIwymtF84TwP0Glr17X74xrXHiwX/pub?gid=0&single=true&output=csv';

        Papa.parse(csvUrl, {
            download: true,
            header: true,
            dynamicTyping: true,
            complete: function (results) {
                allData = results.data;
                showData(allData);
                populateDepartmentDropdown(allData); // Populate the department dropdown
            },
            error: function (error) {
                console.error("Error loading CSV:", error);
            }
        });

        function showData(data) {
            var tbody = document.querySelector("#doctorTable tbody");
            tbody.innerHTML = "";
            var groupedData = {};
            data.forEach(function (row) {
                var floor = row["Floor"] || "Unknown";
                var deptName = row["DeptName"] || "";
                var specialty = row["Specialty"] ? row["Specialty"].replace(/\n/g, "<br>") : "";

                // Group by floor
                if (!groupedData[floor]) {
                    groupedData[floor] = [];
                }
                groupedData[floor].push(row);
            });

            for (var floor in groupedData) {
                var sectionHeader = document.createElement("tr");
                sectionHeader.innerHTML = `<td colspan="3" style="font-weight: bold; background-color: #74613C; color: white; text-align: center;">${floor}</td>`;
                tbody.appendChild(sectionHeader);

                groupedData[floor].forEach(function (row) {
                    var tr = document.createElement("tr");
                    var deptName = row["DeptName"] || "";
                    var specialty = row["Specialty"] ? row["Specialty"].replace(/\n/g, "<br>") : "";

                    // Skip the department column in the table display
                    tr.innerHTML = `
                        <td>${floor}</td>
                        <td>${deptName}</td>
                        <td>${specialty}</td>
                    `;

                    // Store the department data in the row's dataset for filtering
                    tr.dataset.deptName = deptName.toLowerCase();
                    tr.dataset.specialty = specialty.toLowerCase();

                    tbody.appendChild(tr);
                });
            }
        }

        function searchTable() {
            var input = document.getElementById("search").value.toLowerCase();
            var department = document.getElementById("departmentDropdown").value.toLowerCase();
            var specialty = document.getElementById("specialtyDropdown").value.toLowerCase();

            var tbody = document.querySelector("#doctorTable tbody");
            tbody.innerHTML = '';
            if (input.trim() === "" && department === "" && specialty === "") {
                showData(allData);
                return;
            }

            var filteredData = allData.filter(row => {
                var deptName = row["DeptName"] ? row["DeptName"].toLowerCase() : "";
                var deptSpecialty = row["Specialty"] ? row["Specialty"].toLowerCase() : "";
                var match = (deptName + " " + deptSpecialty).includes(input);

                // Filter by department and specialty if selected
                if (department && deptName !== department) return false;
                if (specialty && !deptSpecialty.includes(specialty)) return false;

                return match;
            });

            showData(filteredData);
            if (filteredData.length > 0) {
                document.querySelector("#doctorTable").scrollIntoView({ behavior: "smooth" });
            }
        }

        function populateDepartmentDropdown(data) {
            var departmentDropdown = document.getElementById("departmentDropdown");
            var departments = [...new Set(data.map(row => row["DeptName"] || ""))];

            departments.forEach(function (dept) {
                var option = document.createElement("option");
                option.value = dept;
                option.innerHTML = dept;
                departmentDropdown.appendChild(option);
            });
        }

        function updateSpecialtyDropdown() {
            var department = document.getElementById("departmentDropdown").value;
            var specialtyDropdown = document.getElementById("specialtyDropdown");
            specialtyDropdown.innerHTML = '<option value="">All Specialties</option>'; // Clear current options

            var specialties = [];
            if (department) {
                specialties = allData.filter(row => row["DeptName"] === department)
                    .map(row => row["Specialty"]);
            } else {
                specialties = [...new Set(allData.map(row => row["Specialty"] || ""))];
            }

            specialties.forEach(function (specialty) {
                var option = document.createElement("option");
                option.value = specialty;
                option.innerHTML = specialty;
                specialtyDropdown.appendChild(option);
            });
        }
    </script>

</body>

</html>
